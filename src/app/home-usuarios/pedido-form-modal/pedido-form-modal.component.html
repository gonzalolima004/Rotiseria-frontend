<div class="modal-backdrop fade show"></div>
<div class="modal fade show d-block" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-md modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">
      <!-- Header -->
      <div class="modal-header border-0 bg-gradient p-4">
        <div class="d-flex align-items-center gap-2">
          <div class="icon-circle">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <h2 class="modal-title fw-bold m-0">Datos del pedido</h2>
        </div>
        <button type="button" class="btn-close btn-close-black" (click)="cerrarModal()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body p-4">
        <form>
          <!-- Datos cliente -->
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold small text-muted text-uppercase">DNI</label>
              <input
                type="text"
                class="form-control form-control-lg"
                [(ngModel)]="dni_cliente"
                name="dni_cliente"
                maxlength="8"
                placeholder="Ej: 44441308"
                (blur)="buscarClientePorDni()"
              />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold small text-muted text-uppercase"
                >Nombre completo</label
              >
              <input
                maxlength="50"
                type="text"
                class="form-control form-control-lg"
                [(ngModel)]="nombre_cliente"
                (ngModelChange)="nombre_cliente = capitalizar($event)"
                name="nombre_cliente"
                placeholder="Tu nombre completo"
              />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold small text-muted text-uppercase">Teléfono</label>
            <input
              type="text"
              class="form-control form-control-lg"
              [value]="telefono_cliente"
              (input)="onTelefonoInput($event)"
              (keydown)="bloquearPrefijo($event)"
              maxlength="17"
              name="telefono_cliente"
              placeholder="+54 345 4030582"
            />
          </div>

          <!-- Tipo de entrega -->
          <div class="mb-3">
            <label class="form-label fw-bold small text-muted text-uppercase d-block mb-3">
              Tipo de entrega
            </label>
            <div class="checkbox-group">
              <!-- Retiro -->
              <div class="form-check form-check-card">
                <input
                  class="form-check-input"
                  type="radio"
                  name="modalidad_entrega"
                  id="retiro"
                  [value]="'1'"
                  [(ngModel)]="id_modalidad_entrega"
                  (change)="actualizarTotal()"
                />
                <label class="form-check-label" for="retiro">
                  <div class="check-content">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                      <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="fw-bold">Retiro en local</span>
                  </div>
                </label>
              </div>

              <!-- Envío -->
              <div class="form-check form-check-card">
                <input
                  class="form-check-input"
                  type="radio"
                  name="modalidad_entrega"
                  id="envio"
                  [value]="'2'"
                  [(ngModel)]="id_modalidad_entrega"
                  (change)="actualizarTotal()"
                />
                <label class="form-check-label" for="envio">
                  <div class="check-content">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="1" y="3" width="15" height="13"></rect>
                      <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                      <circle cx="5.5" cy="18.5" r="2.5"></circle>
                      <circle cx="18.5" cy="18.5" r="2.5"></circle>
                    </svg>
                    <span class="fw-bold">Envío a domicilio</span>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Dirección -->
          <div class="mb-3 slide-down" *ngIf="id_modalidad_entrega === '2'">
            <label class="form-label fw-bold small text-muted text-uppercase"
              >Dirección de entrega</label
            >
            <input
              type="text"
              maxlength="40"
              class="form-control form-control-lg"
              [(ngModel)]="direccion_cliente"
              (ngModelChange)="direccion_cliente = capitalizar($event)"
              name="direccion_cliente"
              placeholder="Calle, número, apartamento"
            />
          </div>

          <!-- Forma de pago -->
          <div class="mb-4">
            <label class="form-label fw-bold small text-muted text-uppercase d-block mb-3">
              Forma de pago
            </label>
            <div class="checkbox-group">
              <div class="form-check form-check-card">
                <input
                  class="form-check-input"
                  type="radio"
                  name="metodo_pago"
                  id="efectivo"
                  [value]="'1'"
                  [(ngModel)]="id_metodo_pago"
                />
                <label class="form-check-label" for="efectivo">
                  <div class="check-content">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <line x1="12" y1="1" x2="12" y2="23"></line>
                      <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    <span class="fw-bold">Efectivo</span>
                  </div>
                </label>
              </div>

              <div class="form-check form-check-card">
                <input
                  class="form-check-input"
                  type="radio"
                  name="metodo_pago"
                  id="tarjeta"
                  [value]="'2'"
                  [(ngModel)]="id_metodo_pago"
                />
                <label class="form-check-label" for="tarjeta">
                  <div class="check-content">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                      <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    <span class="fw-bold">Tarjeta</span>
                  </div>
                </label>
              </div>

              <div class="form-check form-check-card">
                <input
                  class="form-check-input"
                  type="radio"
                  name="metodo_pago"
                  id="transferencia"
                  [value]="'3'"
                  [(ngModel)]="id_metodo_pago"
                />
                <label class="form-check-label" for="transferencia">
                  <div class="check-content">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                    <span class="fw-bold">Transferencia</span>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Totales -->
          <div class="alert alert-info d-flex flex-column py-3 mb-0 border-0">
            <ng-container *ngIf="id_modalidad_entrega === '2'; else soloTotal">
              <div class="d-flex justify-content-between fw-bold fs-5">
                <span class="text-primary">Total del pedido:</span>
                <span class="text-primary">$ {{ total }}</span>
              </div>

              <div class="d-flex justify-content-between fw-bold fs-5">
                <span class="text-primary">Envío:</span>
                <span class="text-primary">$ {{ costoEnvio }}</span>
              </div>

              <hr class="my-2" />

              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold fs-5 text-primary text-uppercase">Total a pagar:</span>
                <span class="fw-bold fs-4 text-primary">$ {{ totalConEnvio }}</span>
              </div>
            </ng-container>

            <ng-template #soloTotal>
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold fs-5 text-primary text-uppercase">Total a pagar:</span>
                <span class="fw-bold fs-4 text-primary">$ {{ totalConEnvio }}</span>
              </div>
            </ng-template>
          </div>
        </form>
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0 p-4 bg-light gap-2">
        <button
          class="btn btn-outline-secondary btn-lg flex-grow-1"
          (click)="cerrarModal()"
          [disabled]="cargando"
        >
          Cancelar
        </button>
        <button
          class="btn btn-primary btn-lg flex-grow-1 fw-bold"
          (click)="enviarPedido()"
          [disabled]="cargando"
        >
          {{ cargando ? 'Procesando...' : 'Realizar pedido' }}
        </button>
      </div>
    </div>
  </div>
</div>
